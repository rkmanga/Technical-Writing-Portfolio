---
tableOfContents: true
---

# Notification Service

The notification service provides a mechanism to allow sending messages sent from server or client to another client.

## Overview
The notification service uses point-to-point messaging.

### Services
The Notification service defines three interfaces:

* bnet.protocol.notification.v2.client.NotificationService: The client portion of the notification service that supports sending notifications to a client.
* bnet.protocol.notification.v2.client.NotificationListener: A listener object for receiving notification events.
* bnet.protocol.notification.v2.server.NotificationService: The server portion of the notification service that supports sending notifications to a client.

### Components
The following components diagram outlines the actors for the Notification service.
![](/docs/build/social/images/plantuml8155743692218351961.png)

### SDK Documentation
The BGS SDK package comes with a PDF of auto-generated API documentation. Each time you download the package, you'll find a current version of the PDF in the ```\doc``` folder.

## Use cases and examples
Example cases for Notification include:
* A player sending another player an invitation to spectate
* Notifying a user that their account inventory has a new item
* Notify a player in WOW that their subscription will expire in X days

## Integration Guide
The following integration guide documents details on each step of implementing notifications.

### SendNotification
The SendNotification API is designed for a client to deliver a notification to other clients. This allows a point-to-point message to be sent from a server or client to another client. Before calling this method, the client must be successfully created first.

Please note that the client doesn't need to be subscribed in order to receive messages, however the listener interface must be implemented to receive messages. Notification delivery is also not guaranteed, as the sender does not receive any feedback if the message was successfully delivered. Also, notifications are not persistent, so if the target client is not currently connected, delivery of the notification will fail.

#### Client to Client

### NotificationLimits

<table class="confluenceTable"><colgroup><col><col></colgroup><tbody><tr><th class="confluenceTh">Name</th><th class="confluenceTh">Description</th></tr><tr><td >type</td><td >The notification type. External notification type typically uses Program.Name such as "VIPR.Invitation"</td></tr><tr><td >max_payload</td><td ><p>The max payload limit is maximum size in bytes/characters for a single message payload.</p><p>the payload upper limit applies only to the text field, so check is in characters (which can be up to 2x this in bytes for unicode text)</p></td></tr><tr><td colspan="1" >interval</td><td colspan="1" >The interval is the time interval in seconds that traffic limits will be evaluated</td></tr><tr><td colspan="1" >targets</td><td colspan="1" ><p>The targets are the maximum number of different entities that can be targeted by notifications in a single interval period</p></td></tr><tr><td colspan="1" >messages</td><td colspan="1" ><p>The messages are the maximum number of notification messages that can be sent in a single interval period</p></td></tr></tbody></table>

### NotificationBehavoir

<table class="confluenceTable"><colgroup><col><col><col><col></colgroup><tbody><tr><th class="confluenceTh">Name</th><th class="confluenceTh">Description</th><th colspan="1" class="confluenceTh">Default</th><th class="confluenceTh">In HA</th></tr><tr><td >type</td><td >The notification type. External notification type typically uses Program.Name such as "D3.NotificationMessage"</td><td colspan="1" ><br></td><td ><br></td></tr><tr><td colspan="1" >deny_on_sender_account_mute</td><td colspan="1" ><p>deny when sender's AuthenticationRecord::GetAccountMuted() returns true (registered sex offenders have an account license 197)</p></td><td colspan="1" >false</td><td rowspan="3" >GetSession in SessionService</td></tr><tr><td colspan="1" >deny_on_target_account_mute</td><td colspan="1" >deny when receiver's AuthenticationRecord::GetAccountMuted() returns true (registered sex offenders have an account license 197)</td><td colspan="1" >false</td></tr><tr><td colspan="1" >deny_on_account_squelch</td><td colspan="1" >deny when AccountRecord::IsSquelched(gameAccount)&nbsp; returns true</td><td colspan="1" >false</td></tr><tr><td colspan="1" >deny_on_account_blocked</td><td colspan="1" >deny when the block list for a target includes the sender's account</td><td colspan="1" >false</td><td colspan="1" >IsPlayerBlockedRequest in BlockListService</td></tr><tr><td colspan="1" >require_friendship_on_account_trial_edition</td><td colspan="1" >notification delivery to friends only when AuthenticationRecord::GetAccountPaid() returns false</td><td colspan="1" >false</td><td colspan="1" >GetSession in SessionService, FriendsService</td></tr><tr><td colspan="1" >require_friendship_on_account_manual_review</td><td colspan="1" >notification delivery to friends only when AuthenticationRecord::GetManualReview() returns true</td><td colspan="1" >false</td><td colspan="1" >GetSession in SessionService, FriendsService</td></tr><tr><td colspan="1" >echo_on_send</td><td colspan="1" >notification will be delivered to the sender's account upon delivery to the target</td><td colspan="1" >false</td><td colspan="1" >Same</td></tr><tr><td colspan="1" >write_to_chatlog</td><td colspan="1" ><p>the name of the notification attribute to write in the chatlog (format processed by blizzard business intelligence) this attribute is accessed as a string value</p></td><td colspan="1" ><br></td><td colspan="1" >Not used (Need to check)</td></tr><tr><td colspan="1" >replace_notification_type_on_echo</td><td colspan="1" ><p>The notification type will be replaced on echo NotificationBehavior configuration will apply to the echo name in ::DeliverNotification only</p></td><td colspan="1" ><br></td><td colspan="1" >Same</td></tr><tr><td colspan="1" >always_deliver_to_all_game_accounts</td><td colspan="1" ><p>By default the game account, if provided, is used as a filter for the target of a notification.</p><p>However, this option allows the server to lookup the target <a href="http://battle.net/" class="external-link" rel="nofollow">battle.net</a> account by game account and then perform delivery to all game accounts.</p></td><td colspan="1" >false</td><td colspan="1" >Same</td></tr><tr><td colspan="1" >do_not_deliver_to_self</td><td colspan="1" >Prevent delivery of a notification to the game account that sent the notification</td><td colspan="1" >false</td><td colspan="1" >Same</td></tr><tr><td colspan="1" >always_deliver_to_all_friend_game_accounts</td><td colspan="1" ><p>By default the game account, if provided, is used as a filter for the target of a notification.</p><p>However, this option allows the server to lookup the target <a href="http://battle.net/" class="external-link" rel="nofollow">battle.net</a> account by game account and then perform delivery to all game accounts, only if the target is a friend.</p></td><td colspan="1" >false</td><td colspan="1" >FriendsService</td></tr><tr><td colspan="1" >deprecated_restrict_deliver_to_single_program_id</td><td colspan="1" >This field index was never used and subsequently (and safely), just removed</td><td colspan="1" ><br></td><td colspan="1" >Deprecated</td></tr><tr><td colspan="1" >restrict_delivery_to_single_program</td><td colspan="1" ><p>Restrict delivery of a notifications to game accounts that have different program ids The program id is a FourCC value.</p></td><td colspan="1" ><br></td><td colspan="1" >Same</td></tr><tr><td colspan="1" >report_undeliverable_error</td><td colspan="1" >When delivery fails return ERROR_NOTIFICATION_UNDELIVERABLE otherwise return ERROR_OK.</td><td colspan="1" >true</td><td colspan="1" >Same</td></tr><tr><td colspan="1" >validate_on_trusted_sender</td><td colspan="1" ><p>When a notification is sent from a trusted sender, it should be validated the same way it would be validated if sent from an untrusted sender.</p></td><td colspan="1" >false</td><td colspan="1" >Same</td></tr><tr><td colspan="1" >account_trial_restriction_override_for_program_id</td><td colspan="1" ><p>Allow games to override trial account restrictions<br>NOTE: This field is used to preserve legacy behavior on SC2 and Heroes. This should not be used for any other game.</p></td><td colspan="1" ><br></td><td colspan="1" >Same</td></tr></tbody></table>

The notification service provides a mechanism to allow sending messages sent from server or client to another client.

There are two types of delivery method which are point-to-point notification and subscription based server publication. In classic notification service, most message/delivery validation is done in the proxy level and the subscribers are stored in the Memcache, however the subscribers will be stored in the persistent storage in HA since the proxy will not have any state.

In V2 client protocol, client protocol is broken to two part, Notification and Publication service. Notification takes point-to-point messaging features and Publication allows a client to subscribe to one or more topics for a set of identity values.

## SendNotification

SendNotification API is designed for client to deliver a notification to other clients. This allows point-to-point message sent from server or client to another client. A client should have done the session creation and you will get the information through API in the Session service.

It doesn't need to subscribe in order to receive the messages. Notification delivery is not guaranteed. The sender does not receive any feedback as to weather of not the message was actually delivered. Notifications are not persistent. If the target client is not currently connected, delivery of the notification will fail.

![](/docs/build/social/images/plantuml3642796119711329604.png)

## Client V2 Protocol

### V1 - OnNotificationReceived

```
message Notification
{
  optional EntityId sender_id = 1;
  required EntityId target_id = 2;
  required string type = 3;
  repeated Attribute attribute = 4;
  optional EntityId sender_account_id = 5;
  optional EntityId target_account_id = 6;
  optional string sender_battle_tag = 7 [(field_options).log = HIDDEN];
  optional string target_battle_tag = 8 [(field_options).log = HIDDEN];
  optional account.v1.Identity forwarding_identity = 10;
}
```

### V2 - NotificationReceivedNotification

```
message NotificationReceivedNotification
{
  repeated Notification notifications = 1;
  {
    optional string type = 1 [(valid).string.size = {min:1, max:512}];
    optional UserDescription sender = 2;
    {
      optional uint64 account_id = 1;
    }
    optional UserDescription target = 3;
    {
      optional uint64 account_id = 1;
    }
    repeated protocol.v2.Attribute attribute = 4;
    {
      optional string name = 1;
      optional Variant value = 2;
    }
    optional uint64 creation_time_ms = 5;
  }
}
```

### V2 - PublicationReceivedNotification

```
message PublicationReceivedNotification
{
  repeated Article articles = 1;
  {
    optional Target target = 1;
    {
      optional string topic_name = 1 [(valid).string.size = {min:1, max:512}];
      optional string identity = 2 [(valid).string.size = {min:1, max:512}];
    }
    repeated protocol.v2.Attribute attribute = 2;
    {
      optional string name = 1;
      optional Variant value = 2;
    }
    optional uint64 creation_time_ms = 3;
  }
}
```

*   There are two separated event messages in protocol V2.
    *   NotificationListener: A listener for receiving notification events sent from SendNotification API
    *   PublicationListener: A listener for receiving publication events sent from Publish API

## Configuration

Notification configuration used to define various limits on the Notification service. NotificationLimits limits number of the notification messages in the specific interval or payload or targets. NotificationBehavior provides specific behaviors for notification types. Each flag is used to check that the sender or receiver or message itself is appropriate for the delivery.

### NotificationLimits

<table class="confluenceTable"><colgroup><col><col></colgroup><tbody><tr><th class="confluenceTh">Name</th><th class="confluenceTh">Description</th></tr><tr><td >type</td><td >The notification type. External notification type typically uses Program.Name such as "VIPR.Invitation"</td></tr><tr><td >max_payload</td><td ><p>The max payload limit is maximum size in bytes/characters for a single message payload.</p><p>the payload upper limit applies only to the text field, so check is in characters (which can be up to 2x this in bytes for unicode text)</p></td></tr><tr><td colspan="1" >interval</td><td colspan="1" >The interval is the time interval in seconds that traffic limits will be evaluated</td></tr><tr><td colspan="1" >targets</td><td colspan="1" ><p>The targets are the maximum number of different entities that can be targeted by notifications in a single interval period</p></td></tr><tr><td colspan="1" >messages</td><td colspan="1" ><p>The messages are the maximum number of notification messages that can be sent in a single interval period</p></td></tr></tbody></table>

### NotificationBehavior

<table class="confluenceTable"><colgroup><col><col><col><col></colgroup><tbody><tr><th class="confluenceTh">Name</th><th class="confluenceTh">Description</th><th colspan="1" class="confluenceTh">Default</th><th class="confluenceTh">In HA</th></tr><tr><td >type</td><td >The notification type. External notification type typically uses Program.Name such as "D3.NotificationMessage"</td><td colspan="1" ><br></td><td ><br></td></tr><tr><td colspan="1" >deny_on_sender_account_mute</td><td colspan="1" ><p>deny when sender's AuthenticationRecord::GetAccountMuted() returns true (registered sex offenders have an account license 197)</p></td><td colspan="1" >false</td><td rowspan="3" >GetSession in SessionService</td></tr><tr><td colspan="1" >deny_on_target_account_mute</td><td colspan="1" >deny when receiver's AuthenticationRecord::GetAccountMuted() returns true (registered sex offenders have an account license 197)</td><td colspan="1" >false</td></tr><tr><td colspan="1" >deny_on_account_squelch</td><td colspan="1" >deny when AccountRecord::IsSquelched(gameAccount)&nbsp; returns true</td><td colspan="1" >false</td></tr><tr><td colspan="1" >deny_on_account_blocked</td><td colspan="1" >deny when the block list for a target includes the sender's account</td><td colspan="1" >false</td><td colspan="1" >IsPlayerBlockedRequest in BlockListService</td></tr><tr><td colspan="1" >require_friendship_on_account_trial_edition</td><td colspan="1" >notification delivery to friends only when AuthenticationRecord::GetAccountPaid() returns false</td><td colspan="1" >false</td><td colspan="1" >GetSession in SessionService, FriendsService</td></tr><tr><td colspan="1" >require_friendship_on_account_manual_review</td><td colspan="1" >notification delivery to friends only when AuthenticationRecord::GetManualReview() returns true</td><td colspan="1" >false</td><td colspan="1" >GetSession in SessionService, FriendsService</td></tr><tr><td colspan="1" >echo_on_send</td><td colspan="1" >notification will be delivered to the sender's account upon delivery to the target</td><td colspan="1" >false</td><td colspan="1" >Same</td></tr><tr><td colspan="1" >write_to_chatlog</td><td colspan="1" ><p>the name of the notification attribute to write in the chatlog (format processed by blizzard business intelligence) this attribute is accessed as a string value</p></td><td colspan="1" ><br></td><td colspan="1" >Not used (Need to check)</td></tr><tr><td colspan="1" >replace_notification_type_on_echo</td><td colspan="1" ><p>The notification type will be replaced on echo NotificationBehavior configuration will apply to the echo name in ::DeliverNotification only</p></td><td colspan="1" ><br></td><td colspan="1" >Same</td></tr><tr><td colspan="1" >always_deliver_to_all_game_accounts</td><td colspan="1" ><p>By default the game account, if provided, is used as a filter for the target of a notification.</p><p>However, this option allows the server to lookup the target battle.net account by game account and then perform delivery to all game accounts.</p></td><td colspan="1" >false</td><td colspan="1" >Same</td></tr><tr><td colspan="1" >do_not_deliver_to_self</td><td colspan="1" >Prevent delivery of a notification to the game account that sent the notification</td><td colspan="1" >false</td><td colspan="1" >Same</td></tr><tr><td colspan="1" >always_deliver_to_all_friend_game_accounts</td><td colspan="1" ><p>By default the game account, if provided, is used as a filter for the target of a notification.</p><p>However, this option allows the server to lookup the target battle.net account by game account and then perform delivery to all game accounts, only if the target is a friend.</p></td><td colspan="1" >false</td><td colspan="1" >FriendsService</td></tr><tr><td colspan="1" >deprecated_restrict_deliver_to_single_program_id</td><td colspan="1" >This field index was never used and subsequently (and safely), just removed</td><td colspan="1" ><br></td><td colspan="1" >Deprecated</td></tr><tr><td colspan="1" >restrict_delivery_to_single_program</td><td colspan="1" ><p>Restrict delivery of a notifications to game accounts that have different program ids The program id is a FourCC value.</p></td><td colspan="1" ><br></td><td colspan="1" >Same</td></tr><tr><td colspan="1" >report_undeliverable_error</td><td colspan="1" >When delivery fails return ERROR_NOTIFICATION_UNDELIVERABLE otherwise return ERROR_OK.</td><td colspan="1" >true</td><td colspan="1" >Same</td></tr><tr><td colspan="1" >validate_on_trusted_sender</td><td colspan="1" ><p>When a notification is sent from a trusted sender, it should be validated the same way it would be validated if sent from an untrusted sender.</p></td><td colspan="1" >false</td><td colspan="1" >Same</td></tr><tr><td colspan="1" >account_trial_restriction_override_for_program_id</td><td colspan="1" ><p>Allow games to override trial account restrictions<br>NOTE: This field is used to preserve legacy behavior on SC2 and Heroes. This should not be used for any other game.</p></td><td colspan="1" ><br></td><td colspan="1" >Same</td></tr></tbody></table>

*   These are the notification types registered in Production:
    * WHISPER
    * WHISPER\_ECHO
    * AccountInventoryNewItem
    * TYPING
    * WTCG.SpectatorInvite
    * DST2.NotificationMessage
    * VIPR.Invitation
    * App.WhisperVoiceNotification
    * D3.NotificationMessage
    * WoW.Gamedata
    * WTCG.UtilNotificationMessage
    * BSAp.NotificationMessage
